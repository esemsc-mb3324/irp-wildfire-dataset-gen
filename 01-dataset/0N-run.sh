#!/bin/bash

# this bash file will set a number runs for the number of times to run 01-run.sh.
# It will save the run number is input_tracking.txt which is set up in a csv format.
# It will save the run number so that the rest of the params can be written on the same line
# by set_params.py (which writes the rest of the params). This should be the
# structure of the input_tracking.txt file: run, xign,yign,fuel,slp,asp,ws,wd,m1,m10,m100,cc,ch,cbh,cbd,lhc,lwc
# The first line is the header, and the rest of the lines are the runs.
# After writing the number, the script will call set_params.py to write the rest of the parameters
# and to set the parameters in elmfire.data.in and 01-run.sh. Then, it will call 01-run.sh to run the simulation.
# It will then create a directory in ./cases called ./case_{run} and move the inputs and outputs folders
# that are generated by 01-run.sh as ./inputs and ./outputs in that directory.

if [ -z "$1" ]; then
    echo "Usage: $0 <number_of_runs>"
    exit 1
fi

NUM_RUNS=$1
RUN_DIR="./cases"
mkdir -p $RUN_DIR
for (( run=1; run<=NUM_RUNS; run++ )); do
    echo "Running simulation for run number: $run"
    
    # Call set_params.py to set the parameters
    python3 set_params.py $run
    
    # Run the simulation
    bash 01-run.sh
    
    # Create a directory for this run and move inputs and outputs
    RUN_CASE_DIR="$RUN_DIR/case_$run"
    mkdir -p $RUN_CASE_DIR
    mv outputs/* $RUN_CASE_DIR/
    
done
